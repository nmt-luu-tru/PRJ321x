### T√†i Nguy√™n Tham Kh·∫£o: T·ªëi ∆Øu V√† C·∫•u H√¨nh Connection Pool JDBC C·ªßa Tomcat Cho M√¥i Tr∆∞·ªùng S·∫£n Xu·∫•t

Khi tri·ªÉn khai ·ª©ng d·ª•ng tr√™n m√¥i tr∆∞·ªùng s·∫£n xu·∫•t, vi·ªác t·ªëi ∆∞u h√≥a connection pool c·ªßa Tomcat l√† r·∫•t quan tr·ªçng ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªáu su·∫•t, t√≠nh ·ªïn ƒë·ªãnh v√† kh·∫£ nƒÉng x·ª≠ l√Ω s·ªë l∆∞·ª£ng l·ªõn k·∫øt n·ªëi t·ª´ ng∆∞·ªùi d√πng. D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë t√†i nguy√™n h·ªØu √≠ch gi√∫p b·∫°n c·∫•u h√¨nh v√† ƒëi·ªÅu ch·ªânh connection pool JDBC c·ªßa Tomcat cho m√¥i tr∆∞·ªùng s·∫£n xu·∫•t.

#### 1. **C·∫•u H√¨nh `jdbc-pool` ƒê·ªÉ ƒê·∫°t Hi·ªáu Su·∫•t Cao Trong M√¥i Tr∆∞·ªùng S·∫£n Xu·∫•t**

Blog n√†y h∆∞·ªõng d·∫´n chi ti·∫øt c√°ch c·∫•u h√¨nh v√† t·ªëi ∆∞u connection pool c·ªßa Tomcat cho ·ª©ng d·ª•ng c√≥ l∆∞·ª£ng ng∆∞·ªùi d√πng cao. N√≥ cung c·∫•p c√°c th√¥ng s·ªë c·∫•u h√¨nh quan tr·ªçng nh∆∞:

- S·ªë l∆∞·ª£ng k·∫øt n·ªëi t·ªëi ƒëa (`maxActive`).
- Th·ªùi gian ch·ªù k·∫øt n·ªëi (`maxWait`).
- T·∫ßn su·∫•t ki·ªÉm tra k·∫øt n·ªëi (`validationInterval`).
- C√°c th√¥ng s·ªë li√™n quan ƒë·∫øn th·ªùi gian v√† ph∆∞∆°ng th·ª©c ki·ªÉm tra k·∫øt n·ªëi (`testOnBorrow`, `testWhileIdle`).

üîó [Configuring jdbc-pool for high-concurrency](https://my.oschina.net/shipley/blog/519449)

---

#### 2. **C√°c M·∫πo V√† Th·ªß Thu·∫≠t Th·ª±c T·∫ø ƒê·ªÉ T·ªëi ∆Øu Apache Tomcat Cho Hi·ªáu Su·∫•t Cao**

B√†i vi·∫øt tr√™n trang EG Innovations cung c·∫•p c√°c m·∫πo v√† th·ªß thu·∫≠t th·ª±c t·∫ø ƒë·ªÉ c·∫£i thi·ªán hi·ªáu su·∫•t c·ªßa Tomcat trong m√¥i tr∆∞·ªùng s·∫£n xu·∫•t. M·ªôt s·ªë ƒëi·ªÉm n·ªïi b·∫≠t trong b√†i vi·∫øt bao g·ªìm:

- T·ªëi ∆∞u h√≥a b·ªô nh·ªõ heap c·ªßa JVM.
- S·ª≠ d·ª•ng `G1 Garbage Collector` ƒë·ªÉ c·∫£i thi·ªán hi·ªáu su·∫•t x·ª≠ l√Ω b·ªô nh·ªõ.
- C·∫•u h√¨nh v√† gi√°m s√°t connection pool, t·ªëi ∆∞u s·ªë l∆∞·ª£ng k·∫øt n·ªëi, th·ªùi gian ch·ªù v√† t·∫ßn su·∫•t ki·ªÉm tra k·∫øt n·ªëi.
- C·∫£i thi·ªán t·ªëc ƒë·ªô x·ª≠ l√Ω c·ªßa `thread pool` ƒë·ªÉ gi·∫£m th·ªùi gian x·ª≠ l√Ω c√°c y√™u c·∫ßu t·ª´ ng∆∞·ªùi d√πng.

üîó [Real-World Tips and Tricks to Tune Apache Tomcat for High Performance](https://www.eginnovations.com/blog/tomcat-performance-tuning/)

---

#### 3. **X√°c ƒê·ªãnh S·ªë L∆∞·ª£ng K·∫øt N·ªëi T·ªëi ∆Øu Trong Connection Pool**

Tr√™n di·ªÖn ƒë√†n StackOverflow, c√¢u h·ªèi n√†y th·∫£o lu·∫≠n v·ªÅ c√°ch t√≠nh to√°n v√† thi·∫øt l·∫≠p s·ªë l∆∞·ª£ng k·∫øt n·ªëi t·ªëi ∆∞u cho connection pool c·ªßa Tomcat. B√†i vi·∫øt ƒë∆∞a ra c√°c ph∆∞∆°ng ph√°p ƒë·ªÉ x√°c ƒë·ªãnh s·ªë l∆∞·ª£ng k·∫øt n·ªëi ph√π h·ª£p d·ª±a tr√™n:

- S·ªë l∆∞·ª£ng ng∆∞·ªùi d√πng ƒë·ªìng th·ªùi.
- T·∫£i tr·ªçng c·ªßa ·ª©ng d·ª•ng.
- S·ªë l∆∞·ª£ng CPU v√† b·ªô nh·ªõ hi·ªán c√≥ tr√™n server.
- Hi·ªáu su·∫•t c·ªßa c∆° s·ªü d·ªØ li·ªáu (DBMS).

K·∫øt h·ª£p v·ªõi c√°c c√¥ng c·ª• gi√°m s√°t, b·∫°n c√≥ th·ªÉ tinh ch·ªânh c√°c th√¥ng s·ªë nh∆∞ `maxActive`, `initialSize`, `maxIdle` ƒë·ªÉ ƒë·∫°t hi·ªáu su·∫•t t·ªët nh·∫•t cho ·ª©ng d·ª•ng c·ªßa m√¨nh.

üîó [Optimal number of connections in connection pool](http://stackoverflow.com/questions/1208077/optimal-number-of-connections-in-connection-pool)

---

### G·ª£i √ù C·∫•u H√¨nh Connection Pool Tomcat Cho M√¥i Tr∆∞·ªùng S·∫£n Xu·∫•t
D∆∞·ªõi ƒë√¢y l√† m·ªôt c·∫•u h√¨nh m·∫´u cho `context.xml` c·ªßa Tomcat khi thi·∫øt l·∫≠p k·∫øt n·ªëi JDBC cho m√¥i tr∆∞·ªùng s·∫£n xu·∫•t:

```xml
<Context>
    <Resource name="jdbc/web_student_tracker"
              auth="Container"
              type="javax.sql.DataSource"
              maxActive="50"
              maxIdle="10"
              minIdle="5"
              maxWait="10000"
              initialSize="10"
              removeAbandonedTimeout="60"
              removeAbandoned="true"
              logAbandoned="true"
              validationQuery="SELECT 1"
              testOnBorrow="true"
              testOnReturn="false"
              testWhileIdle="true"
              timeBetweenEvictionRunsMillis="5000"
              minEvictableIdleTimeMillis="30000"
              driverClassName="com.mysql.cj.jdbc.Driver"
              url="jdbc:mysql://localhost:3306/web_student_tracker"
              username="webstudent"
              password="webstudent"/>
</Context>
```

**Gi·∫£i Th√≠ch C√°c Th√¥ng S·ªë C·∫•u H√¨nh**:
- **`maxActive="50"`**: S·ªë l∆∞·ª£ng k·∫øt n·ªëi t·ªëi ƒëa m√† pool c√≥ th·ªÉ t·∫°o ra. Khi ƒë·∫°t gi·ªõi h·∫°n n√†y, c√°c k·∫øt n·ªëi m·ªõi s·∫Ω ph·∫£i ch·ªù.
- **`maxIdle="10"`**: S·ªë l∆∞·ª£ng k·∫øt n·ªëi t·ªëi ƒëa m√† pool c√≥ th·ªÉ gi·ªØ ·ªü tr·∫°ng th√°i kh√¥ng ho·∫°t ƒë·ªông.
- **`minIdle="5"`**: S·ªë l∆∞·ª£ng k·∫øt n·ªëi t·ªëi thi·ªÉu m√† pool ph·∫£i duy tr√¨, ngay c·∫£ khi kh√¥ng c√≥ k·∫øt n·ªëi n√†o ƒëang ho·∫°t ƒë·ªông.
- **`maxWait="10000"`**: Th·ªùi gian ch·ªù t·ªëi ƒëa (t√≠nh b·∫±ng milliseconds) khi kh√¥ng c√≥ k·∫øt n·ªëi n√†o kh·∫£ d·ª•ng. Sau th·ªùi gian n√†y, n·∫øu v·∫´n kh√¥ng c√≥ k·∫øt n·ªëi, s·∫Ω n√©m l·ªói `SQLException`.
- **`initialSize="10"`**: S·ªë l∆∞·ª£ng k·∫øt n·ªëi s·∫Ω ƒë∆∞·ª£c t·∫°o ngay khi pool kh·ªüi ƒë·ªông.
- **`removeAbandoned="true"`**: Cho ph√©p Tomcat gi·∫£i ph√≥ng c√°c k·∫øt n·ªëi kh√¥ng s·ª≠ d·ª•ng (abandoned).
- **`logAbandoned="true"`**: Ghi log khi m·ªôt k·∫øt n·ªëi kh√¥ng s·ª≠ d·ª•ng b·ªã gi·∫£i ph√≥ng.
- **`validationQuery="SELECT 1"`**: C√¢u l·ªánh SQL ki·ªÉm tra k·∫øt n·ªëi c√≥ ho·∫°t ƒë·ªông kh√¥ng.
- **`testOnBorrow="true"`**: Ki·ªÉm tra k·∫øt n·ªëi tr∆∞·ªõc khi m∆∞·ª£n t·ª´ pool.
- **`timeBetweenEvictionRunsMillis="5000"`**: Th·ªùi gian ngh·ªâ gi·ªØa c√°c l·∫ßn ki·ªÉm tra k·∫øt n·ªëi nh√†n r·ªói (milliseconds).
- **`minEvictableIdleTimeMillis="30000"`**: Th·ªùi gian m·ªôt k·∫øt n·ªëi c√≥ th·ªÉ nh√†n r·ªói tr∆∞·ªõc khi b·ªã lo·∫°i b·ªè (milliseconds).

---

### T·ªïng K·∫øt
Vi·ªác c·∫•u h√¨nh v√† t·ªëi ∆∞u connection pool trong Tomcat r·∫•t quan tr·ªçng ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªáu su·∫•t v√† kh·∫£ nƒÉng m·ªü r·ªông cho ·ª©ng d·ª•ng c·ªßa b·∫°n trong m√¥i tr∆∞·ªùng s·∫£n xu·∫•t. Hy v·ªçng r·∫±ng c√°c t√†i li·ªáu v√† c·∫•u h√¨nh m·∫´u tr√™n s·∫Ω gi√∫p b·∫°n c√≥ c√°i nh√¨n r√µ r√†ng v√† chi ti·∫øt h∆°n v·ªÅ c√°ch qu·∫£n l√Ω connection pool m·ªôt c√°ch hi·ªáu qu·∫£.

N·∫øu b·∫°n g·∫∑p b·∫•t k·ª≥ kh√≥ khƒÉn ho·∫∑c th·∫Øc m·∫Øc n√†o trong qu√° tr√¨nh c·∫•u h√¨nh, h√£y tham kh·∫£o c√°c t√†i li·ªáu ƒë√£ ƒë·ªÅ c·∫≠p ho·∫∑c li√™n h·ªá v·ªõi c·ªông ƒë·ªìng l·∫≠p tr√¨nh ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£!
